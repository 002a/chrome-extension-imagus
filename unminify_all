#!/bin/bash

if ! [ -x "$(command -v js-beautify)" ]; then
	# https://pypi.org/project/jsbeautifier/
	sudo pip install jsbeautifier
fi

if ! [ -x "$(command -v tidy)" ]; then
	# https://github.com/htacg/tidy-html5
	sudo apt install tidy-html5
fi

unminify () {
	inFile="$1"
	outFile="unminified/$1"
	echo "'$inFile'  =>  '$outFile'"
	js-beautify --disable-preserve-newlines -o $outFile $inFile
}

unminify_html () {
	inFile="$1"
	outFile="unminified-$1"
	echo "'$inFile'  =>  '$outFile'"
	tidy --indent yes -quiet --show-warnings false -output $outFile $inFile
}


unminify_html background.html
unminify_html options.html

mkdir -p unminified
unminify defaults.jsn
unminify sieve.jsn
unminify locales.jsn

mkdir -p unminified/includes
unminify includes/app.js
unminify includes/content.js

mkdir -p unminified/js
unminify js/app_bg.js
unminify js/background.js
unminify js/options.js
unminify js/SieveUI.js
